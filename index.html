<!DOCTYPE html>
<html lang="en">
    <head>
        <title>ACE in Action</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
        <style type="text/css" media="screen">
            #editor {
                position: absolute;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
            }
            iframe {
                border: none;
            }
        </style>
    </head>
    <body>
        <div id="editor" style="width:50%; height:100%;">&lt;h1&gt; Hello &lt;/h1&gt;</div>
        <div style="position:absolute; top:0px; right:0px; width: 50%; height: 100%;">
            <iframe id="target" style="position:absolute; top:0px; right:0px; width: 100%; height: 100%;"></iframe>
        </div>
        <button onclick="runJavaScript()" class="btn btn-primary" style="z-index:1000; position:absolute; bottom:0; left:0; width:50%;">Run Javascript</button>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.0/ace.js"></script>
        <script>
            var iFrame = document.getElementById('target');
            var iFrameBody;

            window.onload = function () {
                console.log('load');
                if ( iFrame.contentDocument ) {
                    iFrameBody = iFrame.contentDocument.getElementsByTagName('body')[0];
                }
                else if ( iFrame.contentWindow ) {
                    iFrameBody = iFrame.contentWindow.document.getElementsByTagName('body')[0];
                }
                var output = '';
                for (var l = 0; l < editor.session.getDocument().$lines.length; l++) {
                    output += editor.session.getDocument().$lines[l];
                    output += '\n';
                }
                iFrameBody.innerHTML = output;
            }

            var editor = ace.edit("editor");
            editor.setTheme("ace/theme/monokai");
            editor.getSession().setMode("ace/mode/html");

            editor.on("change", function(e) {
                if ( iFrame.contentDocument ) {
                    iFrameBody = iFrame.contentDocument.getElementsByTagName('body')[0];
                }
                else if ( iFrame.contentWindow ) {
                    iFrameBody = iFrame.contentWindow.document.getElementsByTagName('body')[0];
                }
                var output = '';
                for (var l = 0; l < editor.session.getDocument().$lines.length; l++) {
                    output += editor.session.getDocument().$lines[l];
                    // output += '\n';
                }
                iFrameBody.innerHTML = output;
            });

            function runJavaScript () {
                var script = '';
                var scriptRE = iFrameBody.innerHTML.match("<script>(.*)<\/script>");
                if (scriptRE) {
                    script = 'var document = iFrame.contentDocument;' + scriptRE[1];
                    // console.log(scriptRE[1]);
                    // console.log(script);
                    eval(script);
                }
            }
        </script>
    </body>
</html>